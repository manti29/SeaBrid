var table = null;
$(function () {
    table = initDataTable();
    bindNew();
    bindEdit();
    bindDelete()
});
function bindNew() {
    $("a#new").click(function () {
        $("#modal_new input").val("");
        $("#modal_new").modal("show")
    });
    $("#new_ok").click(function () {
        checkRequired("#modal_new") && $.ajax({
            type: "POST",
            url: "../../../api/admin/chn_regions/",
            dataType: "json",
            data: {regionCode: $("#modal_new input[name=code]").val(), regionName: $("#modal_new input[name=name]").val()}
        }).done(function (a) {
            0 === a.code ? (table.row.add({
                regionCode: $("#modal_new input[name=code]").val(),
                regionName: $("#modal_new input[name=name]").val()
            }).draw(!1).nodes().to$().click(function () {
                table.$("tr.selected").removeClass("selected");
                $(this).addClass("selected")
            }), sysAlert("success", "\u6210\u529f\uff01", "\u4fdd\u5b58\u6210\u529f\u3002"), $("#modal_new").modal("hide")) : sysAlert("error", "\u9519\u8bef\uff01", "[" + a.msg + " " + a.code + "]")
        }).fail(function (a) {
            sysAlert("error", "\u9519\u8bef\uff01", "[" + a.status + " " + a.statusText + "]")
        })
    })
}
function bindEdit() {
    $("a#edit").click(function () {
        if (null != table) {
            var a = table.row(".selected").data();
            $("#modal_edit input[name=code]").val(a.regionCode);
            $("#modal_edit input[name=name]").val(a.regionName);
            $("#modal_edit").modal("show")
        }
    });
    $("#edit_ok").click(function () {
        if (checkRequired("#modal_edit")) {
            var a = table.row(".selected").data().regionCode;
            $.ajax({
                type: "post",
                url: "../../../api/admin/chn_regions/" + a + "/?method=put",
                dataType: "json",
                data: {regionName: $("#modal_edit input[name=name]").val()}
            }).done(function (a) {
                0 ===
                a.code ? (a = table.row(".selected").data(), a.regionName = $("#modal_edit input[name=name]").val(), table.row(".selected").data(a).draw(!1), sysAlert("success", "\u6210\u529f\uff01", "\u4fee\u6539\u6210\u529f\u3002"), $("#modal_edit").modal("hide")) : sysAlert("error", "\u9519\u8bef\uff01", "\u4fee\u6539\u5931\u8d25\u3002[" + a.msg + " " + a.code + "]")
            }).fail(function (a) {
                sysAlert("error", "\u9519\u8bef\uff01", "\u4fee\u6539\u5931\u8d25\u3002[" + a.status + " " + a.statusText + "]")
            })
        }
    })
}
function bindDelete() {
    $("a#delete").click(function () {
        if (null != table) {
            var a = table.row(".selected").data();
            $("#modal_delete span#code").text(a.regionCode);
            $("#modal_delete span#name").text(a.regionName);
            $("#modal_delete").modal("show")
        }
    });
    $("#delete_ok").click(function () {
        var a = table.row(".selected").data().regionCode;
        $.ajax({type: "post", url: "../../../api/admin/chn_regions/" + a + "/?method=delete"}).done(function (a) {
            0 === a.code ? (table.row(".selected").remove().draw(!1), sysAlert("success", "\u6210\u529f\uff01",
                "\u5220\u9664\u6210\u529f\u3002"), $("#modal_delete").modal("hide")) : sysAlert("error", "\u9519\u8bef\uff01", "\u5220\u9664\u5931\u8d25\u3002[" + a.msg + " " + a.code + "]")
        }).fail(function (a) {
            sysAlert("error", "\u9519\u8bef\uff01", "\u5220\u9664\u5931\u8d25\u3002[" + a.status + " " + a.statusText + "]")
        })
    })
}
function initDataTable() {
    return $("#table-regions").DataTable({
        pagingType: "simple_numbers",
        lengthMenu: [[12, 20, 50, -1], [12, 20, 50, "\u5168\u90e8"]],
        language: {url: "../../../static/datatables/locale/zh_CN.txt"},
        ajax: {url: "../../../api/admin/chn_regions/", type: "GET"},
        columns: [{data: "regionCode"}, {data: "regionName"}],
        columnDefs: [{type: "chinese", targets: 1}],
        order: [[0, "asc"]],
        initComplete: function () {
            var a = this.api();
            a.$("tr").click(function () {
                a.$("tr.selected").removeClass("selected");
                $(this).addClass("selected")
            })
        }
    })
}
;
