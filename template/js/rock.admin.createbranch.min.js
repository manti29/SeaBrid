$(function () {
    initTree();
    initDatePicker();
    bindReset();
    bindSave()
});
function bindReset() {
    $("#reset").click(function () {
        $("form input[type!='button']").val("");
        $("form select").val("");
        $("form textarea").val("");
        initDatePicker()
    })
}
function bindSave() {
    $("#save").click(function () {
        checkRequired("#working_area") && $.ajax({type: "post", url: "../../api/admin/branches/", data: getFormJson($("form"))}).done(function (a) {
            0 === a.code ? ($("#reset").click(), initTree(), sysAlert("success", "\u6210\u529f\uff01", "\u65b0\u5efa\u673a\u6784\u6210\u529f\u3002")) : sysAlert("error", "\u9519\u8bef\uff01", "\u65b0\u5efa\u673a\u6784\u5931\u8d25\u3002[" + a.msg + " " + a.code + "]")
        }).fail(function (a) {
            sysAlert("error", "\u9519\u8bef\uff01", "\u65b0\u5efa\u673a\u6784\u5931\u8d25\u3002[" +
                a.status + " " + a.statusText + "]")
        })
    })
}
function initTree() {
    $("#tree").treeview({
        data: getBranchTree("../../api/admin/branch_tree/"),
        nodeIcon: "glyphicon",
        emptyIcon: "glyphicon",
        expandIcon: "glyphicon glyphicon-plus",
        collapseIcon: "glyphicon glyphicon-minus",
        showTags: !0,
        levels: 3,
        onNodeSelected: function (a, b) {
            $("#parent_code").val(b.no);
            $("#parent_name").val(b.text);
            $("#parent_id").val(b.id)
        }
    })
}
function initDatePicker() {
    var a = $.format.date(new Date, "yyyy-MM-dd");
    $(".pick_date").parents(".form-group").find("input").each(function () {
        $(this).val(a)
    })
};
