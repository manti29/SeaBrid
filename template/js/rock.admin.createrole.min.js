$(function () {
    $("#tree").treeview({
        data: getBranchTree("../../api/admin/branch_tree/"),
        nodeIcon: "glyphicon",
        emptyIcon: "glyphicon",
        expandIcon: "glyphicon glyphicon-plus",
        collapseIcon: "glyphicon glyphicon-minus",
        showTags: !0,
        levels: 3,
        onNodeSelected: function (b, a) {
            $("#branch_code").val(a.no);
            $("#branch_name").val(a.text);
            $("#biz_line").val(a.bizlineCode)
        }
    });
    var c = $.format.date(new Date, "yyyy-MM-dd");
    $(".pick_date").parents(".form-group").find("input").each(function () {
        $(this).val(c)
    });
    $("#next").click(function () {
        checkRequired("#rolebasic") &&
        (1 === $("#tabs li").length ? initDefTab(null, $("#role_name").val()) : $("#tabs li#tab-roledef").click())
    });
    $("#def_ok").click(function () {
        var b = genRoleDef();
        $.ajax({
            type: "POST",
            url: "../../api/admin/roles/",
            dataType: "json",
            data: {
                roleName: $("#role_name").val(),
                description: $("#desc").val(),
                branchNo: $("#branch_code").val(),
                bizLine: $("#biz_line").val(),
                startDate: $("#start_date").val(),
                roledef: JSON.stringify(b)
            }
        }).done(function (a) {
            0 == a.code ? sysAlert("success", "\u6210\u529f\uff01", "\u4fdd\u5b58\u6210\u529f\u3002") :
                sysAlert("error", "\u9519\u8bef\uff01", "\u4fdd\u5b58\u5931\u8d25\u3002[" + a.msg + "\uff0c\u9519\u8bef\u7801\uff1a" + a.code + "]")
        }).fail(function (a) {
            sysAlert("error", "\u9519\u8bef\uff01", "\u4fdd\u5b58\u5931\u8d25\u3002[" + a.status + " " + a.statusText + "]")
        })
    })
});
