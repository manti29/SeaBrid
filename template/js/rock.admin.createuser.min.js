$(function () {
    $("#tree").treeview({
        data: getBranchTree("../../api/admin/branch_tree/"),
        nodeIcon: "glyphicon",
        emptyIcon: "glyphicon",
        expandIcon: "glyphicon glyphicon-plus",
        collapseIcon: "glyphicon glyphicon-minus",
        showTags: !0,
        levels: 3,
        onNodeSelected: function (b, a) {
            $("#branch_code").val(a.no);
            $("#branch_name").val(a.text)
        }
    });
    initDatePicker();
    $("form select").val("U");
    $("#reset").click(function () {
        $("form input[type!='button']").val("");
        $("form select").val("U");
        initDatePicker()
    });
    $("#save").click(function () {
        if (checkRequired("#working_area")) {
            var b =
                $("form").serializeArray(), a = {};
            $.each(b, function () {
                a[this.name] ? (a[this.name].push || (a[this.name] = [a[this.name]]), a[this.name].push(this.value || "")) : a[this.name] = this.value || ""
            });
            $.ajax({type: "post", url: "../../api/admin/users/", data: a}).done(function (a) {
                if (0 === a.code) {
                    a = $("#branch_code").val();
                    var b = $("#branch_name").val();
                    $("#reset").click();
                    $("#branch_code").val(a);
                    $("#branch_name").val(b);
                    sysAlert("success", "\u4fdd\u5b58\u6210\u529f\uff01", "\u65b0\u5efa\u7528\u6237\u6210\u529f\u3002")
                } else sysAlert("error",
                    "\u9519\u8bef\uff01", "\u65b0\u5efa\u7528\u6237\u5931\u8d25\u3002[" + a.msg + " " + a.code + "]")
            }).fail(function (a) {
                sysAlert("error", "\u9519\u8bef\uff01", "\u65b0\u5efa\u7528\u6237\u5931\u8d25\u3002[" + a.status + " " + a.statusText + "]")
            })
        }
    })
});
function initDatePicker() {
    var b = $.format.date(new Date, "yyyy-MM-dd");
    $(".pick_date").parents(".form-group").find("input").each(function () {
        $(this).val(b)
    })
};
